# 데이터 링크 계층
***
## 데이터 링크 계층의 역할과 이더넷
### 데이터 링크 계층의 역할
* 랜에서 데이터를 주고받으려면 데이터링크 계층의 기술이 필요
* 네트워크 장비 간에 신호를 주고받는 규칙을 정하는 계층
  * 그 규칙들 중 일반적으로 많이 사용되는 것이 ``이더넷``

### 이더넷
* 랜에서 데이터를 정상적으로 주고받기 위한 규칙
* 허브는 연결된 모든 컴퓨터에 전달받은 데이터를 보내는데 이를 막기위해서 데이터에 목적지 정보를 추가해서 보내고 목적지 이외의 컴퓨터는 데이터를 받더라도 무시하도록하는 규칙이 있다.
  * MAC주소 이용
* 컴퓨터 여러 대가 동시에 데이터를 보내면 데이터들이 서로 부딪히는 충돌이 발생할 수도 있음
  * 이더넷은 여러 컴퓨터가 동시에 데이터를 전송해도 충돌이 일어나지 않는 구조로 되어 있다.
    * CSMA/CD 사용 -> 데이터를 보내는 시점을 늦춰 충돌을 막음
      * CS : 데이터를 보내려고 하는 컴퓨터가 케이블에 신호가 흐르고 있는지 확인하는 규칙
      * MA : 케이블에 데이터가 흐르고 있지 않으면 데이터를 보내도 된다는 규칙
      * CD : 충돌이 발생하고 있는지 확인하는 규칙
    * 지금은 효율이 좋지않다는 이유로 사용되지않고 ``스위치``를 사용해서 충돌을 막음
***
## MAC주소의 구조
### MAC 주소
* 랜카드에는 ``MAC주소`` 라는 전세계에서 유일한 번호로 이루어진 물리 주소가 정해져 있다.
  * 48bit로 구성 (랜카드 제조사 번호 24bit + 제조사가 랜카드에 붙인 일련번호 24bit)


* OSI의 데이터링크,TCP/IP의 네트워크 계층에서 ``이더넷 헤더``와 ``트레일러``를 붙인다.
  * 이더넷 헤더 : 목적지 MAC주소(6byte) + 출발지 MAC주소(6byte) + 유형(2byte,상위계층의 프로토콜 종류를 식별하는 번호)
  * 트레일러 : FCS(Frame Check Sequence)라고도 불리며,오류가 발생하는지 확인하는 용도로 사용
  * 이더넷 헤더와 트레일러가 추가된 데이터를 ``프레임``이라고 한다.


* 허브는 데이터를 포트에 연결된 모든 컴퓨터로 보내는데 이더넷 헤더에 있는 MAC주소가 자신의 MAC주소와 다르면 데이터를 파기
***
## 스위치의 구조
### 스위치
* 데이터링크 계층에서 동작
* 레이어 2 스위치 or 스위칭 허브라고도 불린다(외형은 허브랑 비슷)
* 스위치 내부에는 ``MAC 주소 테이블``이 있다.

### MAC 주소 테이블
* ``스위치의 포트번호``와 해당 포트에 연결되어 있는 ``컴퓨터의 MAC주소``가 등록되는 데이터베이스

### MAC 주소 학습 기능
* 스위치의 전원을 켠 상태에서는 MAC 주소 테이블에 아무것도 등록되어 있지않음
* 출발지에서 프레임 데이터가 전송되면 MAC 주소 테이블에서 출발지의 MAC 주소가 있는지 확인하고 없으면 출발지 MAC주소를 포트와 함께 등록

### 플러딩(flooding)
* MAC 주소 테이블에 목적지 MAC주소가 등록되어 있지 않다면 모든 포트에 데이터을 전송

### MAC 주소 필터링 
* MAC 주소 테이블에 목적지 MAC 주소가 등록되어 있다면 목적지 컴퓨터에만 데이터를 전송

### ARP(Address Resolution Protocol)
* 목적지 컴퓨터의 IP주소를 이용하여 MAC주소를 찾기 위한 프로토콜(네트워크 계층 주소와 데이터 링크 계층 주소사이의 변환을 담당하는 프로토콜)
* ``IP 주소를 물리주소인 MAC주소로 변환``하는데 사용한다.
* 이더넷 프레임을 전송하려면 목적지 컴퓨터의 MAC 주소를 지정해야 한다.
* 출발지 컴퓨터가 목적지 컴퓨터의 MAC주소를 모르면 알아내기 위해서 네트워크에 브로드캐스트를 하는데 이를 ``ARP 요청``이라한다.
* 요청에 지정된 IP주소를 가진 컴퓨터는 MAC주소를 응답으로 보내는데 이를 ``ARP 응답``이라 한다.
* 출발지 컴퓨터에서는 MAC주소를 얻은 후 MAC주소와 IP 주소의 매핑 정보를 메모리에 보관하는데 이를 ``ARP 테이블``이라 한다.
* 이후 데이터 통신은 ARP 테이블을 참고하여 전송
* IP 주소가 변경되면 해당 MAC주소도 함께 변경되므로 제대로 통신할 수 없기 때문에 ARP테이블에서는 보존기간을 ``ARP캐시``로 지정하고 일정 시간이 지나면 삭제하고 다시 ARP 요청을 한다.
  * ARP 캐시 : 가장 최근에 변환한 IP 대 하드웨어 주소를 보관하고있는 RAM의 한 영역
***
## 데이터가 케이블에서 충돌하지 않는 구조
### 전이중 통신과 반이중 통신
* 통신방식
  * 전이중 통신
    * 데이터의 송수신을 동시에 통신하는 방식
    * 데이터를 동시에 전송해도 충돌이 발생하지 않는다.
    * 컴퓨터 간을 직접 랜케이블로 연결하는 방식은 전이중 통신방식이다.(크로스 케이블)
    * 스위치 또한 전이중 통신방식

  * 반이중 통신
    * 회선 하나로 송신과 수신을 번갈아가면서 통신하는 방식
    * 데이터를 동시에 전송하면 충돌이 발생한다.
    * 허브에 연결하는 경우 반이중 통신방식이다.

### 충돌 도메인
* 반이중 통신 방식으로 동시에 데이터를 전송하면 충돌이 발생하는데 그 영향이 미치는 범위를 ``충돌 도메인``이라고 한다.
  * 허브는 모든 컴퓨터에 충돌의 영향을 미치므로 컴퓨터 전체가 충돌 도메인이 된다.
  * 스위치의 경우 충돌이 일어나더라도 범위가 좁다.
***
## 이더넷의 종류와 특징
### 이더넷 규격
* 이더넷은 케이블 종류나 통신 속도에 따라 다양한 규격으로 분류  

|규격 이름|통신 속도|케이블|케이블 최대 길이|
:---:|:---:|:---:|:---:|
|10BASE5|10Mbps|동축케이블|500m|
|10BASE2|10Mbps|동축케이블|185m|
|10BASE-T|10Mbps|UTP케이블(Cat3이상)|100m|
|100BASE-TX|100Mbps|UTP케이블(Cat5이상)|100m|
|1000BASE-T|1000Mbps|UTP케이블(Cat5이상)|100m|
|10GBASE-T|10Gbps|UTP케이블(Cat6a이상)|100m|

### 규격 이름의 의미
* 10 BASE - T 기준
  * 10 : 통신 속도 -> 10Mbps
  * BASE : 전송방식
  * * \- or 숫자 : 동축케이블의 경우는 길이(100m단위로)를 나타내고 UTP 케이블은 종류를 표시한다.
  * T : 케이블 종류
  